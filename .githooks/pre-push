#!/usr/bin/env bash
set -euo pipefail

repo_root=$(git rev-parse --show-toplevel)
cd "$repo_root"

if command -v pnpm >/dev/null 2>&1; then
  PNPM_BIN="pnpm"
elif [[ -x "$repo_root/.corepack/pnpm" ]]; then
  PNPM_BIN="$repo_root/.corepack/pnpm"
else
  echo "[pre-push] 未找到 pnpm，请先安装 pnpm 或初始化 .corepack/pnpm" >&2
  exit 2
fi

echo "[pre-push] 执行轻量审查: ${PNPM_BIN} review:light"
"$PNPM_BIN" review:light
